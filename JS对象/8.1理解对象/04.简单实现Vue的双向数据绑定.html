<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>简单实现Vue双向数据绑定</title>
</head>
<body>
    <div id="app">
      <input type="text" v-model="username" placeholder="请输入姓名">
      <p>{{username}}</p>
    </div>
  <script>
    let el = document.getElementById('app');
    let data = {_username: 'Tom'}
    let template =el.innerHTML


    // function render() {
    //   console.log(`render：`,);
    //   /{{\s+[\w.]+\s+}}/g
    //   el.innerHTML = template.replace(/{{\s+[\w.]+\s+}}/g, str=> {
    //     console.log(`str：`,str);
        
    //     str = str.slice(0, str.length-2).trim()
    //     console.log(`str 2：`,str);
    //     let res = null;
    //     res = data[str]

    //     console.log(`res：`,res);
    //     return data[str]
    //   })
    //   // console.log(`el.innerHTML：`,el.innerHTML);
    //   Array.from(document.getElementsByTagName('input'))
    //   .filter(element=> element.getAttribute('v-model'))
    //   .forEach(input => {
    //     let bindData = element.getAttribute('v-model');
    //     input.addEventListener('input', function(){
    //       data[bindData] = this.value
    //     },false)
    //     input.value = data[bindData]
    //   })
    // }
    function render() {
      // 初始渲染先替换DOM里面的模板
      el.innerHTML = template.replace(/{{\s+[\w.]+\s+}}/g, (str) => {
        str = str.slice(2, str.length - 2).trim()
        return data[str]
      })
      //双向绑定
      // 获取所有带`v-model`属性的input元素
      Array.from(el.getElementsByTagName('input'))
        .filter(element => element.getAttribute('v-model'))
        .forEach(input => {
        // 为每个input元素进行双向绑定
          let bindData = input.getAttribute('v-model');
          // 监听input时间，动态把input数据传入data
          input.addEventListener('input', function () {
            data[bindData] = this.value;
          }, false)
          // 将data的数据绑定到DOM
          input.value = data[bindData];
        });
    }


    Object.defineProperty(data, 'username', {
    enumerable: true,
    configurable: true,
    get() {
      return this._username;
    },
    set(value) {
      this._username = value;
      render()
    }
  });



  </script>
</body>
</html>